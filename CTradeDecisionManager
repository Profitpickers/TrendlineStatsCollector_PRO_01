//+------------------------------------------------------------------+
//|                                        CTradeDecisionManager.mqh |
//|                                Copyright 2024, vitoiacobellis.it |
//|                                    https://www.vitoiacobellis.it |
//+------------------------------------------------------------------+
#property copyright "Copyright 2024, vitoiacobellis.it"
#property link      "https://www.vitoiacobellis.it"
///+------------------------------------------------------------------+
//| CTradeDecisionManager.mqh                                        |
//| Classe di gestione strategie di ingresso per Trendline PRO       |
//+------------------------------------------------------------------+
#ifndef __CTRADE_DECISION_MANAGER__
#define __CTRADE_DECISION_MANAGER__

class CTradeDecisionManager {
private:
   double micro_angle;  // Angoli delle 3 trendline
   double macro_angle;  // Angoli delle 3 trendline
   double extra_angle;  // Angoli delle 3 trendline
   double delta_mm, delta_me, delta_em;
   double distance;
   int up_count, down_count, support_count;

public:


// Identificatori della strategia attiva
int StrategyID;
string StrategyLabel;


   

   void LoadData(double _micro, double _macro, double _extra,
              double _delta_mm, double _delta_me, double _delta_em,
              double _distance, int _up, int _down, int _support) {
   micro_angle = _micro;
   macro_angle = _macro;
   extra_angle = _extra;
      
      micro_angle = a_micro;
      macro_angle = a_macro;
      extra_angle = a_extra;
      delta_mm = d_mm;
      delta_me = d_me;
      delta_em = d_em;
      distance = dist;
      up_count = up;
      down_count = down;
      support_count = support;
   }

   // Strategia 3001 - TRENDLINE COMPRESSION BREAKOUT
   bool CheckCompressionBUY(double angle_thresh=15.0, double delta_thresh=10.0, double max_dist=30.0) {
      if (MathAbs(micro_angle - macro_angle) < delta_thresh &&
          MathAbs(macro_angle - extra_angle) < delta_thresh &&
          MathAbs(micro_angle - extra_angle) < delta_thresh &&
          micro_angle > angle_thresh &&
          macro_angle > angle_thresh &&
          extra_angle > angle_thresh &&
          distance < max_dist) {
         StrategyID = 3001;
         StrategyLabel = "TL_COMPRESSION_BREAKOUT_BUY";
         return true;
      }
      return false;
   }

   bool CheckCompressionSELL(double angle_thresh=15.0, double delta_thresh=10.0, double max_dist=30.0) {
      if (MathAbs(micro_angle - macro_angle) < delta_thresh &&
          MathAbs(macro_angle - extra_angle) < delta_thresh &&
          MathAbs(micro_angle - extra_angle) < delta_thresh &&
          micro_angle < -angle_thresh &&
          macro_angle < -angle_thresh &&
          extra_angle < -angle_thresh &&
          distance < max_dist) {
         StrategyID = 3001;
         StrategyLabel = "TL_COMPRESSION_BREAKOUT_SELL";
         return true;
      }
      return false;
   }
};



// Strategia 3002 - CONTRARIAN TREND ALIGNMENT
bool CheckContrarianBUY(double delta_thresh = 10.0) {
   if (micro_angle < -15 && macro_angle < -15 && extra_angle < -15 &&
       MathAbs(micro_angle - macro_angle) < delta_thresh &&
       MathAbs(macro_angle - extra_angle) < delta_thresh &&
       MathAbs(micro_angle - extra_angle) < delta_thresh) {
      StrategyID = 3002;
      StrategyLabel = "TL_CONTRARIAN_BUY";
      return true;
   }
   return false;
}

bool CheckContrarianSELL(double delta_thresh = 10.0) {
   if (micro_angle > 15 && macro_angle > 15 && extra_angle > 15 &&
       MathAbs(micro_angle - macro_angle) < delta_thresh &&
       MathAbs(macro_angle - extra_angle) < delta_thresh &&
       MathAbs(micro_angle - extra_angle) < delta_thresh) {
      StrategyID = 3002;
      StrategyLabel = "TL_CONTRARIAN_SELL";
      return true;
   }
   return false;
}




#endif // __CTRADE_DECISION_MANAGER__
//+------------------------------------------------------------------+
